<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Log in to StelTrek Academy">
        <title>OTP - StelTrek Academy</title>
        <link href="/css/tailwind.css" rel="stylesheet">
        <link rel="stylesheet" href="/bhavik-styling/css/main.css">
        <!-- <link rel="stylesheet" href="/bhavik-styling/css/ai-assistant.css"> -->
    
        <!-- âœ… JavaScript Files (Defer & Modules for Performance) -->
        <script src="/js/languageManager.js" defer></script>
    </head>

<body>
    <!-- HEADER -->
  <header class="bg-gray-900/90 backdrop-blur-lg fixed top-0 left-0 w-full z-50 shadow-lg py-4">
    <nav class="container mx-auto flex flex-col md:flex-row items-center justify-between px-4 py-4">
      <!-- Logo -->
      <div class="flex items-center mb-2 md:mb-0">
        <a href="/index.html" aria-label="SharedStars Homepage" class="group">
          <img src="/images/SSLOGO.png" alt="SharedStars Logo" class="h-16 transition-all duration-300 group-hover:drop-shadow-[0_0_25px_rgba(59,130,246,0.7)]" />
        </a>
      </div>
      <!-- Navigation Links -->
      <ul class="flex flex-wrap gap-4">
        <li><a href="/index.html" data-i18n="nav.home">Home</a></li>
        <li><a href="/academy.html" data-i18n="nav.academy">Academy</a></li>
        <li><a href="/about.html" data-i18n="nav.about">About</a></li>
        <li><a href="/leaderboard.html" data-i18n="nav.leaderboard">Leaderboard</a></li>
        <li><a href="/subscribe.html" data-i18n="nav.subscribe">Subscribe</a></li>
      </ul>

      <div class="relative">
        <button id="langDropdownBtn" class="flex items-center gap-2 text-white bg-gray-700 px-4 py-2 rounded-lg">
          <span id="selectedLangIcon">ðŸ‡ºðŸ‡¸</span>
          <span id="selectedLangText">English</span>
          <svg class="w-4 h-4 ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <ul id="langDropdownMenu" class="hidden absolute bg-white shadow-lg rounded-lg mt-2 py-2 w-40">
          <li><button class="dropdown-item" data-lang="en" data-flag="ðŸ‡ºðŸ‡¸" aria-label="Switch to English">ðŸ‡ºðŸ‡¸ English</button></li>
          <li><button class="dropdown-item" data-lang="zh" data-flag="ðŸ‡¨ðŸ‡³" aria-label="Switch to Chinese">ðŸ‡¨ðŸ‡³ Chinese</button></li>
          <li><button class="dropdown-item" data-lang="ko" data-flag="ðŸ‡°ðŸ‡·" aria-label="Switch to Korean">ðŸ‡°ðŸ‡· Korean</button></li>
          <li><button class="dropdown-item" data-lang="es" data-flag="ðŸ‡ªðŸ‡¸" aria-label="Switch to Spanish">ðŸ‡ªðŸ‡¸ Spanish</button></li>
        </ul>
      </div>
      <button data-i18n="nav.getStarted" class="bg-gradient-to-r from-purple-500 to-blue-500 text-black px-6 py-2 rounded-full hover:from-purple-600 hover:to-blue-600 transition">
      </button>
    </nav>      
  </header>

  <section class="h-[1024px]">
    <div class="flex flex-col items-center justify-between">
      <div class="w-[496px] mt-52 rounded-3xl bg-black border-white-100 border-2 items-center justify-between">
        <div class="flex flex-col items-center justify-between">
          <img src="/icons/Vector.png" class="w-[248px] h-[139px]" ></img>
          <image src="/icons/Logo (1).png" class="w-16 h-16"></image>
        </div>
        <div class="flex flex-col items-center justify-between">
          <p class="text-heading5 text-white my-8">Enter verification code</p>
          <p class="text-body-base text-white">Weâ€™ve  sent a code to hello@sharedstars.com</p>
          
          <form action="/verify-otp" method="POST" class="my-6 flex flex-col items-center">
            <div class="flex gap-3">
                <input type="text" maxlength="1" name="otp1" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
                <input type="text" maxlength="1" name="otp2" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
                <input type="text" maxlength="1" name="otp3" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
                <input type="text" maxlength="1" name="otp4" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
                <input type="text" maxlength="1" name="otp5" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
                <input type="text" maxlength="1" name="otp6" class="otp-input w-12 h-12 bg-[#1a1a1a] text-white text-xl text-center border border-gray-700 rounded-lg focus:outline-none focus:border-blue-500">
            </div>
        
            <button type="submit" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-full transition">Verify</button>
        
            <div class="flex justify-between w-full mt-4 text-gray-400 text-sm">
                <div class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2"></path>
                        <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                    <span id="otp-timer">01:59</span>
                </div>
                <a href="#" id="resend-otp" class="text-white hover:text-blue-400 transition">Resend OTP</a>
            </div>
        </form>
        </div>
      </div>
    </div>
  </section>

    <!-- JavaScript for Auto Focus & Timer -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const otpInputs = document.querySelectorAll(".otp-input");
    const otpForm = document.querySelector("form");
    const otpTimer = document.getElementById("otp-timer");
    const resendOTP = document.getElementById("resend-otp");

    // **Get user email from localStorage**
    const userEmail = localStorage.getItem("userEmail");
    if (!userEmail) {
        alert("No email found! Redirecting to signup.");
        window.location.href = "/signup";
        return;
    }

    // **Display user email dynamically**
    document.querySelector(".text-body-base").innerHTML = `Weâ€™ve sent a code to <span class="font-medium text-white">${userEmail}</span>`;

    // **Auto-focus on next input**
    otpInputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
            if (e.target.value.length === 1 && index < otpInputs.length - 1) {
                otpInputs[index + 1].focus();
            }
        });

        input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && index > 0 && !e.target.value) {
                otpInputs[index - 1].focus();
            }
        });
    });

    // **OTP Timer (2 minutes)**
    let timeLeft = 119;
    const interval = setInterval(() => {
        if (timeLeft <= 0) {
            clearInterval(interval);
            otpTimer.textContent = "00:00";
            resendOTP.classList.remove("text-gray-400");
            resendOTP.classList.add("text-blue-400");
            resendOTP.removeAttribute("disabled");
        } else {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            otpTimer.textContent = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
        }
        timeLeft--;
    }, 1000);

    // **Submit OTP to Backend**
    otpForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        // **Get OTP from input fields**
        const otp = [...otpInputs].map(input => input.value).join("");

        if (otp.length !== 6) {
            alert("Please enter a valid 6-digit OTP.");
            return;
        }

        try {
            const response = await fetch("/api/auth/verify-otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: userEmail, otp }),
                credentials: "include" // Include cookies for authentication
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || "OTP verification failed.");
            }

            // âœ… Redirect to congratulations page if OTP is correct
            window.location.href = "/congratulations.html";

        } catch (error) {
            alert(error.message);
        }
    });

    // **Resend OTP Logic**
    resendOTP.addEventListener("click", async (e) => {
        e.preventDefault();

        resendOTP.textContent = "Sending...";
        resendOTP.setAttribute("disabled", "true");

        try {
            const response = await fetch("/api/auth/resend-otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: userEmail })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || "Failed to resend OTP.");
            }

            alert("New OTP sent to your email.");

            // Reset timer
            timeLeft = 119;
            resendOTP.textContent = "Resend OTP";
            resendOTP.setAttribute("disabled", "true");

        } catch (error) {
            alert(error.message);
            resendOTP.textContent = "Resend OTP";
            resendOTP.removeAttribute("disabled");
        }
    });
});
    </script>
</body>
</html>