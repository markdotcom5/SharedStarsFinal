<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Log in to StelTrek Academy">
    <title>Login - StelTrek Academy</title>
    <link href="/css/tailwind.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <!-- <link rel="stylesheet" href="/bhavik-styling/css/main.css"> -->
    <!-- <link rel="stylesheet" href="/bhavik-styling/css/ai-assistant.css"> -->

    <!-- âœ… JavaScript Files (Defer & Modules for Performance) -->
    <script src="/js/translations.js"></script>
    <script src="/js/languageManager.js"></script>
      </head>

<body>
    <!-- HEADER -->
    <header class="fixed top-0 left-0 w-full z-50 bg-black-100">
      <nav class="container mx-auto flex flex-col md:flex-row items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center mb-2 md:mb-0">
          <a href="/index.html" aria-label="SharedStars Homepage" class="group">
            <img src="/images/SSLOGO.png" alt="SharedStars Logo"
              class="w-[200px] h-[40px] transition-all duration-300 group-hover:drop-shadow-[0_0_25px_rgba(59,130,246,0.7)]" />
          </a>
        </div>
        <!-- Navigation Links -->
        <ul class="flex flex-wrap gap-2">
          <li><a class="py-6 px-8 inline-block text-body-small-medium text-white-700" href="/index.html"
              data-i18n="nav.home">Home</a></li>
          <li><a class="py-6 px-8 inline-block text-body-small-medium text-white-700" href="/academy.html"
              data-i18n="nav.academy">Academy</a></li>
          <li><a class="py-6 px-8 inline-block text-body-small-medium text-white-700" href="/about.html"
              data-i18n="nav.about">About</a></li>
          <li><a class="py-6 px-8 inline-block text-body-small-medium text-white-700" href="/leaderboard.html"
              data-i18n="nav.leaderboard">Leaderboard</a></li>
          <li><a class="py-6 px-8 inline-block text-body-small-medium text-white-700" href="/subscribe.html"
              data-i18n="nav.subscribe">Subscribe</a></li>
        </ul>
        <div class="nav-btns flex flex-row items-center gap-4">
          <div class="relative">
            <button id="langDropdownBtn"
              class="dropdown-btn flex items-center gap-2 text-white bg-gray-700 px-4 py-2 rounded-lg">
              <span id="selectedLangIcon">ðŸ‡ºðŸ‡¸</span>
              <span id="selectedLangText">English</span>
              <svg class="w-4 h-4 ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <ul id="langDropdownMenu" class="hidden absolute shadow-lg rounded-lg mt-2 py-2 w-40">
              <li><button class="dropdown-item text-black" data-lang="en" data-flag="ðŸ‡ºðŸ‡¸"
                  aria-label="Switch to English">ðŸ‡ºðŸ‡¸ English</button></li>
              <li><button class="dropdown-item text-black" data-lang="zh" data-flag="ðŸ‡¨ðŸ‡³"
                  aria-label="Switch to Chinese">ðŸ‡¨ðŸ‡³ Chinese</button></li>
              <li><button class="dropdown-item text-black" data-lang="ko" data-flag="ðŸ‡°ðŸ‡·"
                  aria-label="Switch to Korean">ðŸ‡°ðŸ‡· Korean</button></li>
              <li><button class="dropdown-item text-black" data-lang="es" data-flag="ðŸ‡ªðŸ‡¸"
                  aria-label="Switch to Spanish">ðŸ‡ªðŸ‡¸ Spanish</button></li>
            </ul>
          </div>
          <button class="primary-btn relative">
            <span data-i18n="nav.getStarted" class="relative z-1"></span>
          </button>
        </div>
      </nav>
    </header>
<!-- Add this somewhere near the login form -->
<div class="mt-4 text-center text-white-300 text-sm">
  <p>Need help? <span class="text-blue-500 cursor-pointer" id="stella-help">Ask Stella</span></p>
</div>
    <!-- Main Content -->
    <section
    class="form-container bg-loginBg min-h-screen bg-no-repeat bg-cover bg-center flex flex-col items-center !pb-0">
    <div class="py-10 my-auto ">
      <div class="w-[496px] rounded-3xl bg-black border-white-100 border-2 items-center justify-between">
        <div class="flex flex-col items-center justify-between bg-formBgImg bg-top-center">
          <img src="/icons/Vector.png" class="w-[248px] h-[139px]"></img>
          <image src="/icons/Logo (1).png" class="w-16 h-16"></image>
        </div>
        <div class="flex flex-col items-center justify-between px-8 pb-10">
          <p class="text-heading5 text-white my-8">Welcome back</p>
        
          <form id="login-form" class="space-y-6 text-white">
        
            <input type="email" name="email" id="email" placeholder="Email address"
              class="w-full form-control text-body-small-medium px-6 py-4 text-white-300 bg-black border-white-100 border-2 rounded-full bg-gradient-to-br from-black to-white-100"
              required autocomplete="email">
        
            <input type="password" name="password" id="password" placeholder="Password"
              class="w-full form-control text-body-small-medium px-6 py-4 text-white-300 bg-black border-white-100 border-2 rounded-full bg-gradient-to-br from-black to-white-100"
              required autocomplete="current-password">
        
            <div class="flex items-center justify-between">
              <label for="checkbox" class="flex items-center space-x-2 cursor-pointer">
                <input id="checkbox" type="checkbox" class="hidden peer">
                <div class="w-6 h-6 border-2 border-blue-500 rounded-md flex items-center justify-center">
                  <img src="/icons/checker.png" alt="Checked" class="hidden peer-has-checked:visible" />
                </div>
                <span class="text-white text-body-small-medium transition-all duration-300">Remember me</span>
              </label>
              <a href="/reset-password.html" class="text-white text-body-small-medium">Forgot Password?</a>
            </div>
        
            <button type="submit" id="login-btn" class="primary-btn w-full">
              <span class="w-full !py-[13px]">Login</span>
            </button>
        
            <p id="login-error" class="text-red-500 text-sm text-center hidden"></p>
        
          </form>
        
          <div class="flex flex-row gap-[10px] items-center justify-center mt-8">
            <p class="text-white text-body-small-medium">Don't have an account?</p>
            <a href="/signup.html" class="text-blue-500 text-body-small-semibold">Sign up</a>
          </div>
        </div>
        
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
  </section>

    <!-- Footer -->
    <footer>
        <p data-i18n="common.footer">Â© 2024 StelTrek Academy. All rights reserved.</p>
    </footer>

    <!-- JavaScript -->
    <script src="/js/languageManager.js" defer></script>

    <script>
      document.querySelector('#loginForm').addEventListener('submit', async (event) => {
    event.preventDefault();

    const email = document.querySelector('#email').value;
    const password = document.querySelector('#password').value;

    const response = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include', // Important to include cookies
        body: JSON.stringify({ email, password })
    });

    const result = await response.json();

    if (result.success && result.redirectUrl) {
        window.location.href = result.redirectUrl;
    } else {
        alert(result.error || "Login failed");
    }
});

      document.addEventListener("DOMContentLoaded", () => {
    const loginForm = document.getElementById("login-form");
    const loginBtn = document.getElementById("login-btn");
    const loginError = document.getElementById("login-error");
    const checkbox = document.getElementById("checkbox");

    // Check for existing token
    const savedToken = localStorage.getItem("authToken") || sessionStorage.getItem("authToken");
    if (savedToken) {
        window.location.href = "/mission-control.html"; // Redirect to dashboard if logged in
    }

    loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
        console.log("Attempting login with:", email);
        
        const response = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        console.log("Login response status:", response.status);
        const data = await response.json();
        console.log("Login response data:", data);

        if (response.ok) {
            console.log("Login successful, token received");
            localStorage.setItem("authToken", data.token);
            console.log("Redirecting to mission control...");
            window.location.href = "/mission-control.html";
        } else {
            console.error("Login failed:", data.error || "Unknown error");
            alert(data.error || "Login failed. Please check your credentials.");
        }
    } catch (error) {
        console.error("Login error:", error);
        alert("Connection error. Please try again.");
    }
});
    <!-- Add this JavaScript at the end of your script section -->
document.getElementById("stella-help").addEventListener("click", function() {
  alert("Stella: Hello! I'm Stella, your AI assistant. For login issues, please check your email for verification or use the 'Forgot Password' link. If you're new, click 'Sign up' to create an account.");
});
    // Fix checkbox custom styling
    if (checkbox) {
        checkbox.addEventListener('change', function() {
            const checkedIcon = this.nextElementSibling.querySelector('img');
            if (this.checked) {
                checkedIcon.classList.remove('hidden');
            } else {
                checkedIcon.classList.add('hidden');
            }
        });
    }
});
    </script>
          <!-- <script type="module" src="/js/languages.js"></script>
          <script type="module" src="/js/academy.js"></script> -->
    </body>
</html>
