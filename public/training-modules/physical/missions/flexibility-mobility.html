<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flexibility and Mobility Training Mission | SharedStars</title>
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', 'Arial', sans-serif;
            background-color: #0a1128;
            color: #e9e9e9;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(76, 201, 240, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(76, 201, 240, 0);
            }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        /* Card styles */
        .bg-glass {
            background-color: rgba(26, 43, 74, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(76, 201, 240, 0.2);
        }
        
        /* Toast notifications */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(76, 201, 240, 0.9);
            color: #0a1128;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .toast-notification.show {
            transform: translateX(0);
        }
        
        /* Progress bar animation */
        @keyframes progress-fill {
            0% { width: 0; }
            100% { width: var(--progress-value); }
        }
        
        .progress-bar-animated {
            animation: progress-fill 1s ease-out forwards;
        }
        
        /* Breathing animation */
        @keyframes breathing {
            0% {
                transform: scale(0.9);
                background-color: rgba(76, 201, 240, 0.3);
            }
            50% {
                transform: scale(1.1);
                background-color: rgba(76, 201, 240, 0.6);
            }
            100% {
                transform: scale(0.9);
                background-color: rgba(76, 201, 240, 0.3);
            }
        }
        
        .breathing-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto;
            background-color: rgba(76, 201, 240, 0.3);
            animation: breathing 6s infinite ease-in-out;
        }
        
        /* Social sharing panel */
        .social-share-panel {
            position: fixed;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(26, 43, 74, 0.8);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            backdrop-filter: blur(5px);
            z-index: 100;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }
        
        .social-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2d4263;
            border-radius: 50%;
            transition: all 0.3s ease;
            color: white;
        }
        
        .social-btn:hover {
            transform: scale(1.1);
        }
        
        .social-twitter {
            background-color: #1DA1F2;
        }
        
        .social-facebook {
            background-color: #4267B2;
        }
        
        .social-linkedin {
            background-color: #0077B5;
        }
        
        /* STELLA AI chat modal */
        .stella-chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: #1a2b4a;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(76, 201, 240, 0.3);
        }
        
        .user-message {
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-end;
        }
        
        .user-bubble {
            background-color: #1e40af;
            border-radius: 10px 10px 0 10px;
            padding: 10px 15px;
            max-width: 80%;
        }
        
        .ai-message {
            margin-bottom: 15px;
            display: flex;
        }
        
        .ai-bubble {
            background-color: #2d4263;
            border-radius: 10px 10px 10px 0;
            padding: 10px 15px;
            max-width: 80%;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen" data-module="flexibility">
    <!-- STELLA AI Status Bar -->
    <div class="fixed top-0 w-full bg-gray-800/95 border-b border-purple-500/20 z-50 py-2">
        <div class="container mx-auto px-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-3 h-3 bg-green-500 rounded-full pulse-dot"></div>
                <span id="stella-status-message">STELLA: <span class="text-purple-400">Monitoring flexibility & mobility training...</span></span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm">
                    <span class="text-purple-400">HR:</span>
                    <span id="heart-rate-display">68 bpm</span>
                </div>
                <div class="text-sm">
                    <span class="text-green-400">Session:</span>
                    <span id="session-timer">00:00:00</span>
                </div>
                <button id="chat-with-stella" class="px-3 py-1 bg-purple-600 text-xs rounded-full hover:bg-purple-500 transition-colors">
                    Ask STELLA
                </button>
            </div>
        </div>
    </div>
    
    <!-- Social Sharing Panel -->
    <div class="social-share-panel">
        <button class="social-btn social-twitter" id="share-twitter" title="Share on Twitter">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
            </svg>
        </button>
        <button class="social-btn social-facebook" id="share-facebook" title="Share on Facebook">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
            </svg>
        </button>
        <button class="social-btn social-linkedin" id="share-linkedin" title="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
            </svg>
        </button>
    </div>

    <!-- Toast Notification (hidden by default) -->
    <div class="toast-notification" id="toast-message">Progress saved! Keep up the good work!</div>

    <!-- Mission Timeline Indicator -->
    <div class="fixed top-12 w-full bg-gray-800/90 border-b border-purple-500/20 z-40">
        <div class="container mx-auto px-4 py-1">
            <div class="flex justify-between text-sm">
                <div class="text-purple-400">
                    <span class="font-bold">Your Journey: </span>
                    <span>Phase 6 of 10 - Flexibility & Mobility Foundation</span>
                </div>
                <div class="text-green-400">
                    <span class="font-bold">Overall Progress: </span>
                    <span id="overall-progress">58%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 pt-24 pb-24">
        <div class="mb-8 relative z-10">
            <div class="flex items-center mb-4">
                <a href="/training-modules/physical/index.html" class="text-green-400 hover:text-green-300 mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </a>
                <h1 class="text-3xl font-bold">Flexibility and Mobility Training Mission</h1>
                
                <!-- NASA compliance badge -->
                <span class="ml-3 bg-green-900/40 text-green-400 text-xs font-bold px-2 py-1 rounded-full border border-green-500/30">
                    NASA-STD-3001 Compliant
                </span>
            </div>
            <p class="text-gray-400">Improve flexibility and mobility essential for comfortable movement in spacecraft</p>
            
            <!-- Credit earning indicator -->
            <div class="flex items-center mt-2 space-x-3">
                <div class="flex items-center space-x-2 text-yellow-400 font-bold">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>+30 credits per exercise</span>
                </div>
                
                <!-- Certification progress -->
                <div class="flex items-center text-xs text-green-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                    </svg>
                    <span>Physical Readiness: Level 1 Certification: 67% Complete</span>
                </div>
            </div>
        </div>

        <!-- Mission Description -->
        <div class="bg-glass rounded-xl p-6 mb-8">
            <h2 class="text-xl font-bold text-purple-300 mb-4">Mission Briefing</h2>
            <p class="text-gray-300 mb-4">Welcome, astronaut trainee! This mission focuses on improving your flexibility and mobility - critical for comfortable and efficient movement in confined spacecraft spaces and during EVAs. Proper flexibility reduces the risk of injury and enhances performance during space operations.</p>
            
            <div class="bg-gray-800/50 border-l-4 border-purple-500 p-4 rounded-r-lg mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <p class="text-sm text-gray-400">Equipment needed:</p>
                        <p class="text-white">A yoga mat or soft surface, and a chair for support if needed</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Mission duration:</p>
                        <p class="text-white">25-30 minutes</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Mission objective:</p>
                        <p class="text-white">Complete all stretches with proper form to improve flexibility and joint mobility</p>
                    </div>
                </div>
            </div>
            
            <!-- Training reality timeline -->
            <div class="bg-blue-900/20 rounded-lg p-6 mb-6 border border-blue-500/30">
                <h3 class="text-lg font-bold text-blue-300 mb-3">The Space Training Reality</h3>
                <p class="text-gray-300 mb-3">
                    Real astronauts spend years developing the flexibility needed for space missions. While you might see improvements quickly, true space-ready mobility develops over time:
                </p>
                
                <div class="bg-gray-800/50 p-4 rounded-lg mb-3">
                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                        <span>Beginning</span>
                        <span>6 Months</span>
                        <span>1 Year</span>
                        <span>2 Years</span>
                    </div>
                    <div class="h-2 w-full bg-gray-700 rounded-full relative">
                        <div class="h-full rounded-full bg-gradient-to-r from-purple-500 to-blue-400" style="width: 25%"></div>
                        
                        <!-- Timeline Markers -->
                        <div class="absolute w-3 h-3 bg-purple-500 rounded-full" style="left: 25%; top: -4px;"></div>
                    </div>
                    <div class="grid grid-cols-4 text-center text-xs mt-2">
                        <div>
                            <span class="text-purple-400">You are here</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Basic flexibility</span>
                        </div>
                        <div>
                            <span class="text-gray-400">EVA movement ready</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Space-grade mobility</span>
                        </div>
                    </div>
                </div>
                
                <p class="text-blue-300 text-sm">
                    This timeline is normal and healthy! Remember that your body needs time to adapt at the cellular level. Even small improvements are meaningful steps on your journey to space.
                </p>
            </div>
            
            <!-- Why this matters section -->
            <div class="bg-purple-900/30 border border-purple-500/30 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-bold text-purple-300 mb-2">Why This Training Matters</h3>
                <ul class="space-y-2 pl-5 list-disc text-gray-300">
                    <li><strong>Space Application:</strong> In confined spacecraft environments, flexibility allows efficient movement through tight spaces</li>
                    <li><strong>Real-world Benefits:</strong> Improves posture, reduces injury risk, and enhances overall quality of movement</li>
                    <li><strong>Certification Path:</strong> Completing this mission contributes to your "Physical Readiness: Level 1" certification</li>
                    <li><strong>Leaderboard Points:</strong> Earn up to 150 points for your mission completion and performance</li>
                </ul>
            </div>
            
            <!-- STELLA AI Guidance -->
            <div class="flex p-4 bg-gray-800/70 rounded-lg border border-green-500/20">
                <div class="bg-green-500/20 rounded-full p-3 mr-4 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <div>
                    <p class="text-green-300 font-bold mb-1">STELLA AI Guidance:</p>
                    <p class="text-gray-300">I've analyzed your progress and created a personalized training schedule optimized for your physiology. Remember, space training is a marathon, not a sprint. Your body is making adaptations you can't always see. Stay consistent and trust the process - I'll be here to guide you through each phase of your multi-year journey to space readiness.</p>
                </div>
            </div>
        </div>

        <!-- Difficulty Selector -->
        <div class="bg-glass rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold text-purple-300 mb-4">Select Difficulty Level</h3>
            <div class="flex flex-wrap gap-4">
                <button class="difficulty-btn px-4 py-2 bg-purple-600 rounded-lg font-medium active" data-level="beginner">
                    Beginner (Earth Training)
                </button>
                <button class="difficulty-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium" data-level="intermediate">
                    Intermediate (Moon Training)
                </button>
                <button class="difficulty-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium" data-level="advanced">
                    Advanced (Mars Training)
                </button>
            </div>
        </div>

        <!-- Breathing Guide -->
        <div class="bg-glass rounded-xl p-6 mb-8 text-center">
            <h3 class="text-lg font-bold text-purple-300 mb-4">Breathing Guide</h3>
            <div class="breathing-circle mb-4"></div>
            <p id="breath-instruction" class="text-lg text-gray-300">Breathe in... and out...</p>
        </div>

        <!-- Progress Tracking -->
        <div class="bg-glass rounded-xl p-6 mb-8">
            <div class="flex justify-between mb-2">
                <span class="text-gray-400">Mission Progress</span>
                <span class="text-green-400" id="progress-percentage">0%</span>
            </div>
            <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                <div class="h-full bg-purple-500 rounded-full progress-bar-animated" id="mission-progress" style="width: 0%"></div>
            </div>
        </div>

        <!-- Exercise Timer -->
        <div class="bg-glass rounded-xl p-6 mb-8 text-center">
            <h3 class="text-lg font-bold text-purple-300 mb-2">Current Exercise</h3>
            <div class="text-4xl font-bold text-white my-4" id="exercise-timer">00:45</div>
            <div class="flex justify-center gap-4">
                <button class="px-6 py-3 bg-purple-600 hover:bg-purple-500 rounded-lg font-medium" id="start-btn">
                    Start Mission
                </button>
                <button class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium hidden" id="pause-btn">
                    Pause
                </button>
                <button class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium hidden" id="resume-btn">
                    Resume
                </button>
                <button class="px-6 py-3 bg-green-600 hover:bg-green-500 rounded-lg font-medium hidden" id="next-btn">
                    Next Exercise
                </button>
            </div>
        </div>

        <!-- Exercise Display -->
        <div class="bg-glass rounded-xl p-6 mb-8" id="exercises-container">
            <!-- Exercises will be dynamically shown here -->
        </div>

        <!-- Mission Complete (Initially Hidden) -->
        <div class="bg-glass rounded-xl p-8 mb-8 text-center hidden" id="mission-complete">
            <div class="flex justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-green-300 mb-4">Mission Complete!</h2>
            <p class="text-gray-300 mb-6">Congratulations, astronaut! You've successfully completed the Flexibility and Mobility Training Mission. Your improved flexibility and mobility will be crucial for comfortable movement in confined spacecraft environments.</p>
            
            <div class="flex items-center justify-center mb-6">
                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-black font-bold">1</div>
                <div class="h-1 w-16 bg-green-500"></div>
                <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">2</div>
                <div class="h-1 w-16 bg-gray-700"></div>
                <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">3</div>
            </div>
            <p class="text-blue-300 mb-6">You've completed 1/3 of your Physical Readiness: Level 1 certification!</p>
            
            <div class="flex justify-center gap-4">
                <button class="px-6 py-3 bg-purple-600 hover:bg-purple-500 rounded-lg font-medium" onclick="window.location.href='/training-modules/physical/index.html'">
                    Return to Training Hub
                </button>
                <button class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium" onclick="startMission()">
                    Repeat Mission
                </button>
            </div>
        </div>

        <!-- Mission Status -->
        <div class="bg-glass rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold text-purple-300 mb-4">Mission Status</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div class="text-sm text-gray-400 mb-1">Progress</div>
                    <div class="text-xl font-bold text-purple-300" id="mission-progress-value">0%</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div class="text-sm text-gray-400 mb-1">Performance</div>
                    <div class="text-xl font-bold text-green-300" id="performance-score">--</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div class="text-sm text-gray-400 mb-1">Points Earned</div>
                    <div class="text-xl font-bold text-yellow-300" id="points-earned">0</div>
                </div>
                <div class="bg-gray-800/50 rounded-lg p-4 text-center">
                    <div class="text-sm text-gray-400 mb-1">Certification</div>
                    <div class="text-xl font-bold text-purple-300" id="certification-progress">0/3</div>
                </div>
            </div>
        </div>
        
        <!-- AI Feedback Panel (Initially Hidden) -->
        <div class="bg-glass rounded-xl p-6 mb-8 hidden" id="stella-feedback">
            <h3 class="text-lg font-bold text-green-300 mb-4">STELLA AI Feedback</h3>
            <div id="stella-feedback-content" class="text-gray-300">
                <p>Complete exercises to receive personalized AI feedback on your flexibility and mobility.</p>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between">
            <button class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium" onclick="window.location.href='/training-modules/physical/index.html'">
                Back to Training Hub
            </button>
            <button class="px-6 py-3 bg-purple-600 hover:bg-purple-500 rounded-lg font-medium" id="check-status-btn">
                Check Mission Status
            </button>
        </div>
    </div>

    <!-- Bottom Action Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-gray-900/90 border-t border-purple-500/20 py-3 z-40 backdrop-blur-md">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button id="end-session-btn" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg transition-colors">
                        End Session
                    </button>
                    <button id="pause-session-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors">
                        Pause Session
                    </button>
                </div>
                
                <div class="flex items-center space-x-6">
                    <div class="hidden md:flex space-x-8">
                        <span class="text-green-400">Duration: <span id="footer-duration">00:00:00</span></span>
                        <span class="text-purple-400">Exercises: <span id="footer-exercises">0/5</span></span>
                        <span class="text-yellow-400">Credits: <span id="footer-credits">0</span></span>
                    </div>
                    
                    <button id="save-progress-btn" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg transition-colors">
                        Save Progress
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- STELLA AI Chat Modal (Initially Hidden) -->
    <div id="stella-chat-modal" class="stella-chat-modal">
        <div class="modal-content">
            <div class="flex items-center justify-between p-4 bg-gray-800 border-b border-purple-500/20">
                <div class="flex items-center">
                    <div class="bg-green-500/20 rounded-full p-2 mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-green-300">STELLA AI Assistant</h3>
                </div>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div id="chat-container" class="p-4 max-h-80 overflow-y-auto">
                <div class="ai-message">
                    <div class="ai-bubble">
                        I'm here to help with your Flexibility and Mobility training. What would you like to know?
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t border-purple-500/20 flex">
                <input type="text" id="user-input" placeholder="Ask STELLA a question..." class="flex-grow px-4 py-2 bg-gray-800 border border-gray-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                <button id="send-message" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-r-lg font-medium transition-colors">
                    Send
                </button>
            </div>
        </div>
    </div>
<!-- FOOTER -->
<footer class="relative bg-blue-950/90 text-white py-16 overflow-hidden">
    <!-- Animated Floating Particles -->
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute w-2 h-2 bg-blue-400/20 rounded-full animate-float-slow" style="top: 10%; left: 20%;"></div>
      <div class="absolute w-3 h-3 bg-purple-400/20 rounded-full animate-float-medium" style="top: 30%; right: 25%;"></div>
      <div class="absolute w-2 h-2 bg-blue-300/20 rounded-full animate-float-fast" style="bottom: 20%; left: 40%;"></div>
    </div>
    <div class="container mx-auto px-4 relative z-10">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-12 text-center md:text-left">
        <!-- About -->
        <div>
          <h3 class="font-bold text-lg text-blue-400" data-i18n="footer.about.title">About</h3>
          <ul class="space-y-2 mt-4">
            <li><a href="/about.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.about.ourStory">Our Story</a></li>
            <li><a href="/academy.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.about.academy">StelTrek Academy</a></li>
          </ul>
        </div>
        <!-- Community -->
        <div>
          <h3 class="font-bold text-lg text-blue-400" data-i18n="footer.community.title">Community</h3>
          <ul class="space-y-2 mt-4">
            <li><a href="/events.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.community.events">Events</a></li>
            <li><a href="/forums.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.community.forums">Forums</a></li>
          </ul>
        </div>
        <!-- Resources -->
        <div>
          <h3 class="font-bold text-lg text-blue-400" data-i18n="footer.resources.title">Resources</h3>
          <ul class="space-y-2 mt-4">
            <li><a href="/faq.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.resources.faq">FAQ</a></li>
            <li><a href="/support.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.resources.support">Support</a></li>
          </ul>
        </div>
        <!-- Legal -->
        <div>
          <h3 class="font-bold text-lg text-blue-400" data-i18n="footer.legal.title">Legal</h3>
          <ul class="space-y-2 mt-4">
            <li><a href="/terms.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.legal.terms">Terms</a></li>
            <li><a href="/privacy.html" class="hover:text-blue-400 transition-colors" data-i18n="footer.legal.privacy">Privacy</a></li>
          </ul>
        </div>
      <!-- Bottom section with copyright and social media -->
      <div class="mt-12 pt-8 border-t border-blue-900/20 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-500">© 2025 Celestial Technologies, LLC. All rights reserved.</p>
        
        <!-- All 7 social media links -->
        <div class="flex space-x-4 mt-4 md:mt-0">
          <!-- LinkedIn -->
          <a href="https://www.linkedin.com/company/106241890" class="text-gray-400 hover:text-blue-400" aria-label="LinkedIn">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
          </a>
          
          <!-- Twitter/X -->
          <a href="https://x.com/SharedStars" class="text-gray-400 hover:text-blue-400" aria-label="Twitter">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
          </a>
          
          <!-- Facebook -->
          <a href="https://www.facebook.com/SharedStars" class="text-gray-400 hover:text-blue-400" aria-label="Facebook">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
          </a>
          
          <!-- Instagram -->
          <a href="https://www.instagram.com/sharedstarsacademy/" class="text-gray-400 hover:text-blue-400" aria-label="Instagram">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          
          <!-- Telegram -->
          <a href="https://t.me/SharedStars" class="text-gray-400 hover:text-blue-400" aria-label="Telegram">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.372-12 12 0 6.627 5.374 12 12 12 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12zm3.224 17.871c.188.133.43.166.646.085.215-.082.374-.253.463-.489.089-.236.089-.498 0-.734l-1.74-4.36 4.4-2.507c.466-.265.466-.934 0-1.199l-9.65-5.514c-.465-.266-1.048.055-1.047.577l.072 12.71c0 .522.583.843 1.048.577l3.293-1.879zm-8.791-7.414l2.083 1.188-.759 1.329-1.324-.755v-1.762zm6.442 7.385l-1.621.925c-.961.548-2.132-.106-2.132-1.186l-.04-6.99 3.793 7.251z"/></svg>
          </a>
          
          <!-- TikTok -->
          <a href="https://www.tiktok.com/@sharedstarsacademy" class="text-gray-400 hover:text-blue-400" aria-label="TikTok">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
          </a>
          
          <!-- YouTube -->
          <a href="https://www.youtube.com/@SharedStarsAcademy" class="text-gray-400 hover:text-blue-400" aria-label="YouTube">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
          </a>
        </div>
      </div>
    </div>
      </div>
      <script>
        // Update current year dynamically if needed
        document.getElementById("current-year") &&
          (document.getElementById("current-year").textContent = new Date().getFullYear());
      </script>
    </div>
  </div>
  </footer>
    <script>
        // Exercise data for different difficulty levels
        const exercisesByLevel = {
            beginner: [
                {
                    name: "Neck Mobility",
                    description: "Prepares for the variable orientation changes experienced in microgravity.",
                    instructions: "Start in a seated position with a straight back. Slowly turn your head to look right, hold for 5 seconds, return to center. Repeat on the left side. Next, gently tilt your head toward your right shoulder, hold, return to center, and repeat on the left. Perform 5 repetitions for each direction.",
                    duration: 45,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Shoulder Rolls",
                    description: "Improves shoulder mobility needed for EVA suit operations.",
                    instructions: "Stand or sit with good posture. Roll your shoulders forward in large circles 5 times. Then roll them backward 5 times. Keep your movements slow and controlled, focusing on the full range of motion.",
                    duration: 30,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Seated Forward Bend",
                    description: "Increases flexibility in the back and hamstrings for better mobility in confined spaces.",
                    instructions: "Sit on the floor with legs extended forward. Gently reach toward your toes, going only as far as is comfortable. Hold the stretch, feeling it in your hamstrings and lower back. Remember to breathe deeply.",
                    duration: 45,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Gentle Spinal Twist",
                    description: "Enhances torso rotation needed for movement in spacecraft.",
                    instructions: "Sit on the floor with legs extended. Bend your right knee and place your foot on the outside of your left thigh. Place your left elbow on the outside of your right knee and gently twist to the right. Hold for 30 seconds, then switch sides.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Ankle Rotations",
                    description: "Maintains ankle mobility which is crucial during reduced gravity situations.",
                    instructions: "Sit in a chair and extend one leg. Rotate your ankle in a clockwise direction 10 times, then counterclockwise 10 times. Repeat with the other ankle. Focus on a full range of motion in the joint.",
                    duration: 30,
                    image: "/api/placeholder/300/200"
                }
            ],
            intermediate: [
                {
                    name: "Sun Salutation (Modified)",
                    description: "A flowing sequence that warms up the entire body, similar to pre-EVA preparation.",
                    instructions: "Stand tall, reach arms up, then fold forward. Step back to plank, lower halfway, push up to upward dog, then downward dog. Step forward and return to standing. Repeat the sequence 3 times at a steady pace.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Standing Side Bend",
                    description: "Improves lateral flexibility needed for movement in narrow spaces.",
                    instructions: "Stand with feet hip-width apart. Raise your right arm overhead and bend to the left, feeling a stretch along your right side. Hold for 15-20 seconds, then switch sides. Repeat 3 times per side.",
                    duration: 45,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Hip Flexor Stretch",
                    description: "Counteracts hip tightness that may develop in seated positions during spaceflight.",
                    instructions: "Kneel on one knee with the other foot in front, forming a 90-degree angle. Push your hips forward slightly until you feel a stretch in the front of your hip/thigh. Hold for 30 seconds, then switch sides.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Cat-Cow Stretch",
                    description: "Enhances spinal mobility necessary for confined movement patterns.",
                    instructions: "Start on hands and knees. Arch your back upward (cat) while exhaling, then drop your belly toward the floor (cow) while inhaling. Flow between these positions 10 times, moving with your breath.",
                    duration: 45,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Thread the Needle",
                    description: "Improves shoulder and thoracic spine mobility for EVA maneuvers.",
                    instructions: "Start on hands and knees. Thread your right arm under your left arm, lowering your right shoulder to the floor. Hold for 20 seconds, then repeat on the other side. Perform 3 times per side.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                }
            ],
            advanced: [
                {
                    name: "Dynamic Hamstring Stretches",
                    description: "Simulates the changing flexibility demands during EVA operations.",
                    instructions: "Stand on one leg, extend the other leg forward with heel on the ground. Hinge at the hips, reaching toward your toes while maintaining a flat back. Pulse gently 10 times, then hold for 15 seconds. Switch legs and repeat.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Full Spinal Twist",
                    description: "Maximizes rotational mobility needed for complex movement in space.",
                    instructions: "Lie on your back with arms extended in a T-shape. Bring your knees to your chest, then lower them to the right side while keeping shoulders on the floor. Hold for 30 seconds, then switch sides. Repeat 3 times per side.",
                    duration: 75,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Deep Lunge with Rotation",
                    description: "Combines hip opening with thoracic mobility for comprehensive EVA preparation.",
                    instructions: "Step forward into a lunge position. Place your opposite hand on the floor and rotate your upper body toward your front leg, extending your arm upward. Hold for 15 seconds, then switch sides. Complete 3 rotations per side.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Standing Forward Fold to Half Lift",
                    description: "Develops hamstring and lower back flexibility for movement in variable gravity environments.",
                    instructions: "Stand with feet hip-width apart. Fold forward, then lift halfway up with a flat back. Return to fold, then back to half lift. Repeat this flow 10 times, moving with your breath.",
                    duration: 45,
                    image: "/api/placeholder/300/200"
                },
                {
                    name: "Advanced Shoulder Opener",
                    description: "Maximizes shoulder mobility crucial for EVA glove operations.",
                    instructions: "Clasp hands behind your back. Lift your arms up and away from your back while keeping your chest lifted. For additional stretch, fold forward, bringing your clasped hands over your head. Hold for 30 seconds, release, and repeat 3 times.",
                    duration: 60,
                    image: "/api/placeholder/300/200"
                }
            ]
        };

        // Global variables
        let currentLevel = 'beginner';
        let currentExerciseIndex = 0;
        let timer;
        let timeRemaining = 0;
        let isPaused = false;
        let totalExercises = exercisesByLevel[currentLevel].length;
        let sessionStartTime;
        let sessionTimer;
        let breathingInterval;
        let creditsEarned = 0;

        // DOM elements
        const exercisesContainer = document.getElementById('exercises-container');
        const progressBar = document.getElementById('mission-progress');
        const progressPercentage = document.getElementById('progress-percentage');
        const timerDisplay = document.getElementById('exercise-timer');
        const startButton = document.getElementById('start-btn');
        const pauseButton = document.getElementById('pause-btn');
        const resumeButton = document.getElementById('resume-btn');
        const nextButton = document.getElementById('next-btn');
        const missionComplete = document.getElementById('mission-complete');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const breathInstruction = document.getElementById('breath-instruction');
        const sessionTimerDisplay = document.getElementById('session-timer');
        const footerDuration = document.getElementById('footer-duration');
        const footerExercises = document.getElementById('footer-exercises');
        const footerCredits = document.getElementById('footer-credits');
        const saveProgressButton = document.getElementById('save-progress-btn');
        const endSessionButton = document.getElementById('end-session-btn');
        const pauseSessionButton = document.getElementById('pause-session-btn');
        const checkStatusButton = document.getElementById('check-status-btn');
        const chatWithStellaButton = document.getElementById('chat-with-stella');
        const stellaChatModal = document.getElementById('stella-chat-modal');
        const closeModalButton = document.getElementById('close-modal');
        const userInputField = document.getElementById('user-input');
        const sendMessageButton = document.getElementById('send-message');
        const chatContainer = document.getElementById('chat-container');
        const toastMessage = document.getElementById('toast-message');
        const missionProgressValue = document.getElementById('mission-progress-value');
        const performanceScore = document.getElementById('performance-score');
        const pointsEarned = document.getElementById('points-earned');
        const certificationProgress = document.getElementById('certification-progress');
        const stellaFeedback = document.getElementById('stella-feedback');
        const stellaFeedbackContent = document.getElementById('stella-feedback-content');

        // Set up difficulty selection
        difficultyButtons.forEach(button => {
            button.addEventListener('click', function() {
                const level = this.getAttribute('data-level');
                setDifficulty(level);
                
                // Update UI
                difficultyButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.remove('bg-purple-600');
                    btn.classList.add('bg-gray-700');
                });
                this.classList.add('active');
                this.classList.add('bg-purple-600');
                this.classList.remove('bg-gray-700');
                
                showToast(`Difficulty set to ${level}`);
            });
        });

        // Set difficulty level
        function setDifficulty(level) {
            currentLevel = level;
            totalExercises = exercisesByLevel[level].length;
            resetMission();
            footerExercises.textContent = `0/${totalExercises}`;
        }

        // Start the mission
        startButton.addEventListener('click', startMission);

        function startMission() {
            startButton.style.display = 'none';
            pauseButton.style.display = 'inline-block';
            
            // Start session timer
            sessionStartTime = new Date();
            startSessionTimer();
            
            // Start breathing guide
            startBreathingGuide();
            
            // Load first exercise
            loadExercise(0);
            
            // Show toast notification
            showToast('Mission started!');
            
            // Log mission start
            logTrainingEvent('mission_start', {
                missionId: 'flexibility-mobility',
                difficulty: currentLevel
            });
        }

        // Start the session timer
        function startSessionTimer() {
            clearInterval(sessionTimer);
            sessionTimer = setInterval(updateSessionTime, 1000);
        }

        // Update session time displays
        function updateSessionTime() {
            const now = new Date();
            const elapsedMs = now - sessionStartTime;
            const hours = Math.floor(elapsedMs / (1000 * 60 * 60));
            const minutes = Math.floor((elapsedMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsedMs % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            sessionTimerDisplay.textContent = timeString;
            footerDuration.textContent = timeString;
        }

        // Start the breathing guide animation
        function startBreathingGuide() {
            let phase = "inhale";
            breathInstruction.textContent = "Breathe in deeply...";
            
            breathingInterval = setInterval(() => {
                if (phase === "inhale") {
                    phase = "hold";
                    breathInstruction.textContent = "Hold...";
                } else if (phase === "hold") {
                    phase = "exhale";
                    breathInstruction.textContent = "Breathe out slowly...";
                } else {
                    phase = "inhale";
                    breathInstruction.textContent = "Breathe in deeply...";
                }
            }, 2000);
        }

        // Load an exercise by index
        function loadExercise(index) {
            if (index >= totalExercises) {
                completeMission();
                return;
            }

            currentExerciseIndex = index;
            const exercise = exercisesByLevel[currentLevel][index];
            timeRemaining = exercise.duration;
            
            // Update progress bar
            const progressPercentage = (index / totalExercises) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            document.getElementById('progress-percentage').textContent = `${Math.round(progressPercentage)}%`;
            
            footerExercises.textContent = `${index + 1}/${totalExercises}`;
            
            // Update progress value display
            if (missionProgressValue) {
                missionProgressValue.textContent = `${Math.round(progressPercentage)}%`;
            }

            // Create exercise display
            exercisesContainer.innerHTML = '';
            const exerciseElement = document.createElement('div');
            exerciseElement.innerHTML = `
                <div class="flex items-center mb-4">
                    <div class="bg-purple-500/20 text-purple-300 rounded-full px-3 py-1 text-sm mr-3">
                        Exercise ${index + 1}/${totalExercises}
                    </div>
                    <h3 class="text-xl font-bold text-purple-300">${exercise.name}</h3>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-300"><strong class="text-purple-300">Space Application:</strong> ${exercise.description}</p>
                </div>
                
                <div class="flex flex-col md:flex-row gap-6 mb-4">
                    <div class="md:w-1/2">
                        <img src="${exercise.image}" alt="${exercise.name}" class="w-full h-auto rounded-lg">
                    </div>
                    <div class="md:w-1/2 bg-gray-800/50 rounded-lg p-4 border-l-4 border-purple-500">
                        <p class="text-white mb-2"><strong class="text-purple-300">Instructions:</strong></p>
                        <p class="text-gray-300">${exercise.instructions}</p>
                    </div>
                </div>
            `;
            exercisesContainer.appendChild(exerciseElement);

            // Start timer
            updateTimerDisplay();
            startTimer();
        }

        // Timer functions
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(function() {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timer);
                    nextButton.style.display = 'inline-block';
                    pauseButton.style.display = 'none';
                    
                    // Award credits for completed exercise
                    creditsEarned += 30;
                    footerCredits.textContent = creditsEarned;
                    
                    // Show toast notification
                    showToast(`Exercise completed! +30 credits earned.`);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Pause and resume functionality
        pauseButton.addEventListener('click', function() {
            clearInterval(timer);
            isPaused = true;
            pauseButton.style.display = 'none';
            resumeButton.style.display = 'inline-block';
            showToast('Exercise paused');
        });

        resumeButton.addEventListener('click', function() {
            startTimer();
            isPaused = false;
            resumeButton.style.display = 'none';
            pauseButton.style.display = 'inline-block';
            showToast('Exercise resumed');
        });

        // Next exercise button
        nextButton.addEventListener('click', function() {
            nextButton.style.display = 'none';
            pauseButton.style.display = 'inline-block';
            loadExercise(currentExerciseIndex + 1);
        });

        // Complete mission
        function completeMission() {
            exercisesContainer.style.display = 'none';
            timerDisplay.parentElement.style.display = 'none';
            pauseButton.style.display = 'none';
            resumeButton.style.display = 'none';
            nextButton.style.display = 'none';
            progressBar.style.width = '100%';
            progressPercentage.textContent = '100%';
            missionComplete.style.display = 'block';
            
            // Stop timers
            clearInterval(timer);
            clearInterval(breathingInterval);
            
            // Update progress value display to 100%
            if (missionProgressValue) {
                missionProgressValue.textContent = '100%';
            }
            
            // Update points earned
            if (pointsEarned) {
                pointsEarned.textContent = '150';
            }
            
            // Update certification progress
            if (certificationProgress) {
                certificationProgress.textContent = '1/3';
            }
            
            // Update performance score
            if (performanceScore) {
                performanceScore.textContent = '85%';
            }
            
            // Show toast notification
            showToast('Mission Complete! Congratulations!');
            
            // Log mission completion
            logTrainingEvent('mission_complete', {
                missionId: 'flexibility-mobility',
                difficulty: currentLevel,
                performance: 85,
                creditsEarned: 150,
                timeSpent: getSessionDuration()
            });
        }
        
        // Get session duration in seconds
        function getSessionDuration() {
            if (!sessionStartTime) return 0;
            const now = new Date();
            return Math.floor((now - sessionStartTime) / 1000);
        }

        // Reset mission
        function resetMission() {
            // Clear timers
            clearInterval(timer);
            clearInterval(sessionTimer);
            if (breathingInterval) clearInterval(breathingInterval);
            
            // Reset state variables
            currentExerciseIndex = 0;
            timeRemaining = 0;
            isPaused = false;
            creditsEarned = 0;
            sessionStartTime = null;
            
            // Reset UI elements
            exercisesContainer.innerHTML = '';
            exercisesContainer.style.display = 'block';
            timerDisplay.parentElement.style.display = 'block';
            timerDisplay.textContent = '00:00';
            progressBar.style.width = '0%';
            progressPercentage.textContent = '0%';
            missionComplete.style.display = 'none';
            
            // Reset buttons
            startButton.style.display = 'inline-block';
            pauseButton.style.display = 'none';
            resumeButton.style.display = 'none';
            nextButton.style.display = 'none';
            
            // Reset footer displays
            sessionTimerDisplay.textContent = '00:00:00';
            footerDuration.textContent = '00:00:00';
            footerExercises.textContent = `0/${totalExercises}`;
            footerCredits.textContent = '0';
            
            // Reset status displays
            if (missionProgressValue) missionProgressValue.textContent = '0%';
            if (pointsEarned) pointsEarned.textContent = '0';
            if (certificationProgress) certificationProgress.textContent = '0/3';
            if (performanceScore) performanceScore.textContent = '--';
            
            // Reset AI feedback panel
            if (stellaFeedback) stellaFeedback.style.display = 'none';
            
            // Update breathing guide to initial state
            if (breathInstruction) breathInstruction.textContent = 'Breathe in... and out...';
            
            // Log mission reset
            logTrainingEvent('mission_reset', {
                missionId: 'flexibility-mobility',
                difficulty: currentLevel
            });
        }

        // Check mission status button
        checkStatusButton.addEventListener('click', function() {
            stellaFeedback.classList.remove('hidden');
            
            // Generate performance score based on progress
            const currentProgress = parseInt(missionProgressValue.textContent) || 0;
            
            if (currentProgress > 0) {
                // Add some randomness for realism
                const baseScore = 70 + Math.floor(Math.random() * 20);
                performanceScore.textContent = baseScore + '%';
            }
            
            // Update points based on progress
            const earnedPointsValue = Math.floor(currentProgress * 1.5); // Up to 150 points at 100%
            pointsEarned.textContent = earnedPointsValue;
            
            // Update certification progress
            certificationProgress.textContent = currentProgress >= 50 ? '1/3' : '0/3';
            
            // Add AI feedback
            stellaFeedbackContent.innerHTML = `
                <p class="text-green-300 font-bold mb-2">Flexibility Analysis</p>
                <p class="text-gray-300 mb-4">Your flexibility is improving steadily with each session. I've noticed increased range of motion in your shoulder and hip movements.</p>
                <p class="text-purple-300 font-bold mb-2">Recommendations:</p>
                <ul class="list-disc pl-5 space-y-1 text-gray-300">
                    <li>Focus on deep, controlled breathing during each stretch</li>
                    <li>Hold stretches for at least 20-30 seconds for optimal tissue adaptation</li>
                    <li>Pay special attention to your hamstring flexibility - this is crucial for EVA movements</li>
                </ul>
            `;
            
            // Show toast notification
            showToast('Status updated!');
        });

        // Session control buttons
        endSessionButton.addEventListener('click', function() {
            clearInterval(timer);
            clearInterval(sessionTimer);
            clearInterval(breathingInterval);
            
            // Reset UI
            resetMission();
            
            // Show toast notification
            showToast('Session ended. Progress saved!');
        });
        
        pauseSessionButton.addEventListener('click', function() {
            if (isPaused) {
                // Resume session
                startTimer();
                startSessionTimer();
                isPaused = false;
                this.textContent = 'Pause Session';
                showToast('Session resumed');
            } else {
                // Pause session
                clearInterval(timer);
                clearInterval(sessionTimer);
                isPaused = true;
                this.textContent = 'Resume Session';
                showToast('Session paused');
            }
        });
        
        saveProgressButton.addEventListener('click', function() {
            // Log save event
            logTrainingEvent('progress_saved', {
                missionId: 'flexibility-mobility',
                difficulty: currentLevel,
                exerciseCompleted: currentExerciseIndex,
                progress: parseInt(missionProgressValue.textContent) || 0,
                creditsEarned: creditsEarned
            });
            
            // Show toast notification
            showToast('Progress saved successfully!');
        });

        // STELLA chat functionality
        chatWithStellaButton.addEventListener('click', function() {
            stellaChatModal.style.display = 'flex';
        });
        
        closeModalButton.addEventListener('click', function() {
            stellaChatModal.style.display = 'none';
        });
        
        sendMessageButton.addEventListener('click', sendMessageToStella);
        
        userInputField.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                sendMessageToStella();
            }
        });
        
        function sendMessageToStella() {
            const userMessage = userInputField.value.trim();
            if (!userMessage) return;
            
            // Add user message to chat
            chatContainer.innerHTML += `
                <div class="user-message">
                    <div class="user-bubble">
                        ${userMessage}
                    </div>
                </div>
            `;
            
            // Clear input
            userInputField.value = '';
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Generate AI response (simulated)
            setTimeout(() => {
                // Add AI message to chat
                chatContainer.innerHTML += `
                    <div class="ai-message">
                        <div class="ai-bubble">
                            ${getAIResponse(userMessage)}
                        </div>
                    </div>
                `;
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 1000);
        }
        
        // Simulated AI responses based on keywords
        function getAIResponse(message) {
            message = message.toLowerCase();
            
            if (message.includes('stretch') || message.includes('flexibility')) {
                return "Flexibility training is essential for astronauts. In space, your body naturally lengthens due to reduced gravitational forces. Having good flexibility before missions helps your body adapt more comfortably to these changes and prevents discomfort during this adaptation period.";
            } else if (message.includes('mobility') || message.includes('joints')) {
                return "Joint mobility is crucial for EVA operations. Space suits create resistance to movement, so having excellent mobility helps counteract this resistance. Focus especially on shoulder, hip, and spinal mobility, as these are the areas most challenged during spacewalks.";
            } else if (message.includes('breathe') || message.includes('breathing')) {
                return "Breathing is fundamental to effective stretching. When you exhale deeply, your body naturally relaxes, allowing you to go a bit deeper into stretches. Try to maintain a 6-second inhale, 2-second hold, and 8-second exhale pattern for optimal results.";
            } else if (message.includes('pain') || message.includes('hurt') || message.includes('sore')) {
                return "It's important to differentiate between discomfort and pain. Stretching should involve mild discomfort, but never sharp pain. If you experience actual pain, ease off immediately. Post-stretch soreness is normal, but should subside within 24-48 hours.";
            } else {
                return "I'm here to help with your Flexibility and Mobility training. Feel free to ask about specific stretches, techniques, or how this training applies to space missions. Remember that flexibility improvements happen gradually over time - consistency is more important than intensity.";
            }
        }
        
        // Toast notification function
        function showToast(message) {
            toastMessage.textContent = message;
            toastMessage.classList.add('show');
            
            setTimeout(() => {
                toastMessage.classList.remove('show');
            }, 3000);
        }
        
        // Log training events (simulated)
        function logTrainingEvent(eventType, data) {
            console.log(`Training event: ${eventType}`, data);
            
            // In a real implementation, this would send data to a server
            try {
                // Simulated API call
                /*
                fetch('/api/training/log', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        eventType: eventType,
                        timestamp: new Date().toISOString(),
                        userId: 'current-user-id',
                        ...data
                    })
                });
                */
            } catch (e) {
                console.error('Error logging training event:', e);
            }
        }
        
        // Social sharing functionality
        document.getElementById('share-twitter').addEventListener('click', function() {
            const text = encodeURIComponent('I just completed a Flexibility & Mobility training session on SharedStars! #SpaceTraining #SharedStars');
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        });
        
        document.getElementById('share-facebook').addEventListener('click', function() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        });
        
        document.getElementById('share-linkedin').addEventListener('click', function() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('Flexibility & Mobility Training - SharedStars');
            window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}`, '_blank');
        });
        
        // Initialize with beginner difficulty
        setDifficulty('beginner');
    </script>
</body>
</html>